<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TICO IA | Plataforma de Agentes Inteligentes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        /* ==================== SISTEMA DE TEMAS ==================== */
        :root[data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #171717;
            --bg-tertiary: #262626;
            --bg-card: rgba(23, 23, 23, 0.7);
            --bg-input: #171717;
            --text-primary: #ffffff;
            --text-secondary: #d4d4d4;
            --text-tertiary: #737373;
            --border-light: rgba(255, 255, 255, 0.08);
            --border-medium: rgba(255, 255, 255, 0.12);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-glow: rgba(255, 255, 255, 0.15);
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        :root[data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e5e5e5;
            --bg-card: rgba(255, 255, 255, 0.8);
            --bg-input: #ffffff;
            --text-primary: #171717;
            --text-secondary: #404040;
            --text-tertiary: #737373;
            --border-light: rgba(0, 0, 0, 0.08);
            --border-medium: rgba(0, 0, 0, 0.12);
            --glass-bg: rgba(0, 0, 0, 0.02);
            --glass-border: rgba(0, 0, 0, 0.08);
            --accent-glow: rgba(0, 0, 0, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        :root {
            --pure-white: #ffffff;
            --pure-black: #000000;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --sidebar-width: 280px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ==================== RESET E BASE ==================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 30%, var(--accent-glow) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, var(--accent-glow) 0%, transparent 40%);
            z-index: -1;
            pointer-events: none;
        }

        /* ==================== COMPONENTES ==================== */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 20px var(--shadow-color);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            border: none;
            gap: 0.5rem;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .btn-primary { background: var(--text-primary); color: var(--bg-primary); }
        .btn-primary:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-outline { background: transparent; border: 1px solid var(--border-medium); color: var(--text-primary); }
        .btn-outline:hover { background: var(--glass-bg); border-color: var(--text-primary); }

        .input-group { margin-bottom: 1.25rem; position: relative; text-align: left; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-size: 0.85rem; color: var(--text-secondary); font-weight: 500; }
        .input-field {
            width: 100%;
            padding: 0.85rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            transition: all var(--transition-base);
        }
        .input-field:focus { outline: none; border-color: var(--text-primary); background: var(--bg-secondary); }
        .input-field.invalid { border-color: var(--error); }

        .password-wrapper { position: relative; }
        .toggle-password { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-tertiary); z-index: 10; }

        .password-requirements {
            margin-top: 0.75rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 0.7rem;
        }
        .requirement { display: flex; align-items: center; gap: 0.4rem; color: var(--text-tertiary); }
        .requirement.met { color: var(--success); }

        /* ==================== THEME TOGGLE ==================== */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--text-primary);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--shadow-color);
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        .theme-toggle:hover { transform: scale(1.1); }

        /* ==================== LOADING SCREEN ==================== */
        #loadingScreen {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid var(--bg-tertiary);
            border-bottom-color: var(--text-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ==================== AUTH VIEWS ==================== */
        .auth-view {
            min-height: 100vh;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }

        .auth-container {
            display: flex;
            align-items: center;
            gap: 5rem;
            max-width: 1300px;
            width: 100%;
            animation: fadeIn 0.6s ease-out;
        }

        .auth-info {
            flex: 1.2;
            text-align: left;
        }
        .auth-info h2 { font-size: 3.5rem; font-weight: 900; letter-spacing: -2px; line-height: 1.1; margin-bottom: 1.5rem; }
        .auth-info p { font-size: 1.3rem; color: var(--text-secondary); max-width: 550px; border-left: 4px solid var(--text-primary); padding-left: 2rem; }

        .auth-card {
            width: 100%;
            max-width: 600px;
            padding: 3.5rem;
            text-align: center;
        }

        .auth-header { margin-bottom: 2rem; }
        .auth-header i { font-size: 3.5rem; margin-bottom: 1rem; color: var(--text-primary); }
        .auth-header h1 { font-size: 2.2rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 0.5rem; }
        .auth-header p { color: var(--text-secondary); font-size: 1rem; }

        .code-inputs { display: flex; gap: 0.75rem; justify-content: center; margin: 2rem 0; }
        .code-input { width: 50px; height: 60px; text-align: center; font-size: 1.5rem; font-weight: 800; border-radius: 12px; background: var(--bg-input); border: 1px solid var(--border-light); color: var(--text-primary); }
        .code-input:focus { border-color: var(--text-primary); outline: none; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ==================== DASHBOARD LAYOUT ==================== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0; top: 0;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        .sidebar-header { padding: 2rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid var(--border-light); }
        .sidebar-nav { flex: 1; padding: 1.5rem 0; overflow-y: auto; }
        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.85rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-base);
            border-left: 3px solid transparent;
            cursor: pointer;
        }
        .nav-link:hover, .nav-link.active { color: var(--text-primary); background: var(--glass-bg); }
        .nav-link.active { border-left-color: var(--text-primary); background: var(--glass-bg); }

        .main-content { margin-left: var(--sidebar-width); padding: 2rem; max-width: 1400px; transition: margin-left 0.3s ease, padding 0.3s ease; min-height: 100vh; display: flex; flex-direction: column; }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem; gap: 1rem; flex-wrap: wrap; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .stat-card { padding: 1.5rem; }
        .stat-card h3 { font-size: 0.75rem; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }
        .stat-card .value { font-size: 1.5rem; font-weight: 700; }

        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
        .chart-box { padding: 1.5rem; height: 350px; position: relative; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }

        .data-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { text-align: left; color: var(--text-tertiary); font-size: 0.75rem; padding: 1rem; border-bottom: 1px solid var(--border-light); text-transform: uppercase; }
        td { padding: 1rem; border-bottom: 1px solid var(--border-light); font-size: 0.85rem; }

        .badge { padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .badge-online { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-offline { background: rgba(239, 68, 68, 0.1); color: var(--error); }
        .badge-sector { background: var(--bg-tertiary); color: var(--text-secondary); }

        .performance-bar { width: 100%; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; margin-top: 4px; }
        .performance-fill { height: 100%; background: var(--text-primary); border-radius: 3px; }

        /* ==================== CHAT SECTION ==================== */
        .chat-view { display: none; animation: fadeIn 0.4s ease; height: calc(100vh - 150px); }
        .chat-layout { display: flex; flex-direction: column; gap: 1.5rem; height: 100%; }
        
        .chat-main { display: flex; flex-direction: column; height: 100%; flex: 1; }
        .chat-header-main { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .chat-messages-main { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
        
        .message { max-width: 90%; padding: 0.75rem 1rem; border-radius: var(--radius-md); font-size: 0.9rem; position: relative; word-break: break-word; }
        .message.bot { background: var(--bg-tertiary); align-self: flex-start; border-bottom-left-radius: 2px; }
        .message.user { background: var(--text-primary); color: var(--bg-primary); align-self: flex-end; border-bottom-right-radius: 2px; }
        .message-info { font-size: 0.65rem; color: var(--text-tertiary); margin-top: 0.4rem; display: block; }
        
        .supervisor-tag { font-size: 0.6rem; background: var(--info); color: white; padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; display: inline-block; }

        .chat-input-area { padding: 1.5rem; border-top: 1px solid var(--border-light); display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .chat-action-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all var(--transition-base); border: none; color: var(--text-primary); flex-shrink: 0; }
        .chat-action-btn:hover { background: var(--border-medium); }
        .chat-action-btn.recording { background: var(--error); color: white; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .agent-selector-wrapper { min-width: 250px; }

        /* ==================== NOVAS SEÇÕES ==================== */
        .users-view, .logs-view, .chat-logs-view, .settings-view, .agents-view { display: none; animation: fadeIn 0.4s ease; }
        
        .log-item { padding: 0.75rem; border-bottom: 1px solid var(--border-light); font-size: 0.8rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        .log-time { color: var(--text-tertiary); min-width: 140px; }
        .log-action { font-weight: 600; }

        .footer { margin-top: auto; padding: 2rem 0; text-align: center; border-top: 1px solid var(--border-light); color: var(--text-tertiary); font-size: 0.8rem; }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
        }
        .modal-content {
            width: 100%;
            max-width: 500px;
            padding: 2rem;
            animation: modalIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* ==================== MOBILE ==================== */
        .mobile-header { display: none; padding: 1rem 1.5rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border-light); justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }

        /* ==================== RESPONSIVE BREAKPOINTS ==================== */
        
        /* Large Tablets (1024px and below) */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1.5rem; }
            .mobile-header { display: flex; }
            .charts-grid { grid-template-columns: 1fr; }
            .auth-container { flex-direction: column; gap: 2rem; text-align: center; padding: 1rem; }
            .auth-info { text-align: center; }
            .auth-info h2 { font-size: 2.5rem; }
            .auth-info p { margin: 0 auto; border-left: none; border-top: 3px solid var(--text-primary); padding: 1rem 0 0 0; font-size: 1.1rem; }
            .auth-card { padding: 2.5rem; }
            .agent-selector-wrapper { min-width: 100%; margin-bottom: 1rem; }
            .theme-toggle { bottom: 1.5rem; right: 1.5rem; width: 45px; height: 45px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .chat-view { height: calc(100vh - 130px); }
            .chat-input-area { padding: 1rem; gap: 0.75rem; }
        }

        /* Tablets (768px and below) */
        @media (max-width: 768px) {
            .main-content { padding: 1rem; }
            .top-bar { flex-direction: column; align-items: flex-start; gap: 1.5rem; }
            .top-bar > div:first-child { width: 100%; }
            .top-bar > div:last-child { width: 100%; justify-content: space-between; }
            .stats-grid { grid-template-columns: 1fr; gap: 1rem; }
            .stat-card { padding: 1.25rem; }
            .stat-card .value { font-size: 1.3rem; }
            .charts-grid { gap: 1rem; }
            .chart-box { height: 300px; padding: 1.25rem; }
            .auth-card { padding: 2rem; }
            .auth-info h2 { font-size: 2rem; }
            .auth-info p { font-size: 1rem; }
            .code-inputs { gap: 0.5rem; }
            .code-input { width: 45px; height: 55px; font-size: 1.3rem; }
            .modal-content { padding: 1.5rem; }
            .chat-header-main { flex-direction: column; align-items: flex-start; }
            .supervisor-tag { align-self: flex-start; }
            .message { max-width: 95%; }
            .password-requirements { grid-template-columns: repeat(2, 1fr); }
        }

        /* Mobile (480px and below) */
        @media (max-width: 480px) {
            .auth-view { padding: 1rem; }
            .auth-card { padding: 1.5rem; }
            .auth-info h2 { font-size: 1.8rem; }
            .auth-header h1 { font-size: 1.8rem; }
            .auth-header i { font-size: 2.5rem; }
            .btn { padding: 0.65rem 1.25rem; font-size: 0.85rem; }
            .input-field { padding: 0.75rem; }
            .code-inputs { gap: 0.4rem; }
            .code-input { width: 40px; height: 50px; font-size: 1.2rem; }
            .sidebar { width: 100%; max-width: 280px; }
            .sidebar-header { padding: 1.5rem; }
            .nav-link { padding: 0.75rem 1.25rem; }
            .top-bar h1 { font-size: 1.5rem; }
            .chart-box { height: 250px; padding: 1rem; }
            .table-responsive { margin: 0 -1rem; padding: 0 1rem; }
            table { min-width: 600px; }
            .chat-action-btn { width: 35px; height: 35px; }
            .chat-input-area .input-field { font-size: 0.9rem; }
            .footer { padding: 1.5rem 0; font-size: 0.75rem; }
            .theme-toggle { bottom: 1rem; right: 1rem; width: 40px; height: 40px; }
            .password-requirements { grid-template-columns: 1fr; }
            .modal-overlay { padding: 1rem; }
            .modal-content { padding: 1.25rem; }
        }

        /* Small Mobile (360px and below) */
        @media (max-width: 360px) {
            .auth-card { padding: 1.25rem; }
            .auth-info h2 { font-size: 1.6rem; }
            .auth-header h1 { font-size: 1.6rem; }
            .code-inputs { gap: 0.3rem; }
            .code-input { width: 35px; height: 45px; font-size: 1.1rem; }
            .btn { padding: 0.6rem 1rem; font-size: 0.8rem; }
            .top-bar h1 { font-size: 1.3rem; }
            .stat-card { padding: 1rem; }
            .stat-card .value { font-size: 1.2rem; }
            .chat-action-btn { width: 32px; height: 32px; }
            .chat-messages-main { padding: 1rem; }
            .message { padding: 0.6rem 0.8rem; font-size: 0.85rem; }
        }

        /* Landscape Mode */
        @media (max-height: 600px) and (orientation: landscape) {
            .auth-view { padding: 1rem; min-height: auto; }
            .auth-container { gap: 1rem; }
            .auth-info h2 { font-size: 1.8rem; }
            .auth-card { padding: 1.5rem; max-width: 450px; }
            .sidebar { overflow-y: auto; }
            .chat-view { height: calc(100vh - 120px); }
            .chart-box { height: 250px; }
        }

        /* Very Large Screens (1920px and above) */
        @media (min-width: 1920px) {
            .main-content { max-width: 1800px; margin-left: auto; margin-right: auto; }
            .auth-container { max-width: 1600px; }
            .auth-card { max-width: 700px; }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn, .nav-link, .chat-action-btn { min-height: 44px; }
            .input-field, select { min-height: 48px; font-size: 16px; } /* Prevents iOS zoom */
            .code-input { min-height: 55px; font-size: 1.3rem; }
            .nav-link { padding: 1rem 1.5rem; }
        }

        /* Print Styles */
        @media print {
            .bg-mesh, .theme-toggle, .mobile-header, .sidebar, .btn, .chat-input-area, .modal-overlay { display: none !important; }
            .main-content { margin-left: 0; padding: 0; }
            .glass { box-shadow: none; border: 1px solid #ddd; }
            body { background: white; color: black; }
        }

        /* ==================== NOTIFICAÇÕES ==================== */
        #notificationContainer { position: fixed; top: 1.5rem; right: 1.5rem; z-index: 10000; display: flex; flex-direction: column; gap: 0.75rem; max-width: 90vw; }
        .notification { padding: 1rem; border-radius: var(--radius-md); background: var(--bg-secondary); border-left: 4px solid var(--text-primary); box-shadow: 0 4px 20px var(--shadow-color); display: flex; align-items: center; gap: 1rem; min-width: 280px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        @media (max-width: 768px) {
            #notificationContainer { top: 1rem; right: 1rem; left: 1rem; max-width: none; }
            .notification { min-width: auto; width: 100%; }
        }
    </style>
</head>
<body>
    <div class="bg-mesh"></div>

    <header class="mobile-header">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <i class="fas fa-robot"></i>
            <span style="font-weight: 800;">TICO IA</span>
        </div>
        <i class="fas fa-bars menu-btn" id="menuBtn"></i>
    </header>

    <div class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></div>

    <div id="loadingScreen">
        <div class="loader"></div>
        <p style="letter-spacing: 2px; font-size: 0.7rem; color: var(--text-tertiary);">CARREGANDO SISTEMA</p>
    </div>

    <!-- Auth Views (Login) -->
    <div id="authView" class="auth-view" style="display: none;">
        <div class="auth-container">
            <div class="auth-info">
                <h2>Inteligência sob Governança</h2>
                <p>Acesso restrito a colaboradores autorizados. Cada ação é auditada via Safe Learning Loop.</p>
            </div>
            <div class="auth-card glass">
                <div class="auth-header">
                    <i class="fas fa-robot"></i>
                    <h1>TICO IA</h1>
                    <p>Acesse sua central de agentes</p>
                </div>
                <form id="loginForm">
                    <div class="input-group">
                        <label>E-mail Corporativo</label>
                        <input type="email" class="input-field" id="email" placeholder="exemplo@empresa.com" required>
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <div class="password-wrapper">
                            <input type="password" class="input-field" id="password" placeholder="••••••••" required>
                            <i class="fas fa-eye toggle-password" data-target="password"></i>
                        </div>
                    </div>
                    <div style="text-align: right; margin-bottom: 1rem;">
                        <a href="#" id="toReset" style="color: var(--text-tertiary); font-size: 0.8rem; text-decoration: none;">Esqueceu a senha?</a>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Entrar <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <p style="font-size: 0.8rem; color: var(--text-tertiary);">
                        Não tem uma conta? <a href="#" id="toRegister" style="color: var(--text-primary); text-decoration: none; font-weight: 600;">Solicitar Acesso</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register View -->
    <div id="registerView" class="auth-view" style="display: none;">
        <div class="auth-container">
            <div class="auth-info">
                <h2>Inteligência sob Governança</h2>
                <p>Acesso restrito a colaboradores autorizados. Cada ação é auditada via Safe Learning Loop.</p>
            </div>
            <div class="auth-card glass">
                <div class="auth-header">
                    <i class="fas fa-user-plus"></i>
                    <h1>CRIAR CONTA</h1>
                    <p>Junte-se à revolução da IA</p>
                </div>
                <form id="registerForm">
                    <div class="input-group">
                        <label>Nome Completo</label>
                        <input type="text" class="input-field" id="regName" placeholder="Seu nome" required>
                    </div>
                    <div class="input-group">
                        <label>CPF</label>
                        <input type="text" class="input-field" id="regCpf" placeholder="000.000.000-00" maxlength="14" required>
                    </div>
                    <div class="input-group">
                        <label>Setor</label>
                        <select class="input-field" id="regSector" required>
                            <option value="" disabled selected>Selecione seu setor</option>
                            <option value="RH">RH</option><option value="TI">TI</option><option value="DP">DP</option><option value="ENGENHARIA">ENGENHARIA</option>
                            <option value="FINANCEIRO">FINANCEIRO</option><option value="SUPRIMENTOS">SUPRIMENTOS</option><option value="SMS">SMS</option><option value="ADMINISTRATIVO">ADMINISTRATIVO</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>E-mail Corporativo</label>
                        <input type="email" class="input-field" id="regEmail" placeholder="exemplo@empresa.com" required>
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <div class="password-wrapper">
                            <input type="password" class="input-field" id="regPassword" placeholder="Crie uma senha forte" required>
                            <i class="fas fa-eye toggle-password" data-target="regPassword"></i>
                        </div>
                        <div class="password-requirements">
                            <div class="requirement" data-req="uppercase"><i class="fas fa-circle"></i> Maiúscula</div>
                            <div class="requirement" data-req="lowercase"><i class="fas fa-circle"></i> Minúscula</div>
                            <div class="requirement" data-req="number"><i class="fas fa-circle"></i> Número</div>
                            <div class="requirement" data-req="special"><i class="fas fa-circle"></i> Especial</div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="regSubmit" style="width: 100%; margin-top: 1rem;" disabled>
                        Verificar E-mail <i class="fas fa-envelope"></i>
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <p style="font-size: 0.8rem; color: var(--text-tertiary);">
                        Já possui acesso? <a href="#" id="toLoginFromReg" style="color: var(--text-primary); text-decoration: none; font-weight: 600;">Fazer Login</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Verification View -->
    <div id="verifyView" class="auth-view" style="display: none;">
        <div class="auth-card glass">
            <div class="auth-header">
                <i class="fas fa-shield-check"></i>
                <h1>VERIFICAÇÃO</h1>
                <p>Insira o código de 6 dígitos enviado ao seu e-mail</p>
            </div>
            <div class="code-inputs">
                <input type="text" class="code-input" maxlength="1" data-index="0">
                <input type="text" class="code-input" maxlength="1" data-index="1">
                <input type="text" class="code-input" maxlength="1" data-index="2">
                <input type="text" class="code-input" maxlength="1" data-index="3">
                <input type="text" class="code-input" maxlength="1" data-index="4">
                <input type="text" class="code-input" maxlength="1" data-index="5">
            </div>
            <button class="btn btn-primary" id="verifyBtn" style="width: 100%;">Confirmar Código</button>
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="font-size: 0.8rem; color: var(--text-tertiary);">Não recebeu? <a href="#" style="color: var(--text-primary); font-weight: 600;">Reenviar código</a></p>
            </div>
        </div>
    </div>

    <!-- Reset Password View -->
    <div id="resetView" class="auth-view" style="display: none;">
        <div class="auth-card glass">
            <div class="auth-header">
                <i class="fas fa-key"></i>
                <h1>REDEFINIR SENHA</h1>
                <p>Enviaremos um link de recuperação</p>
            </div>
            <form id="resetForm">
                <div class="input-group">
                    <label>E-mail Corporativo</label>
                    <input type="email" class="input-field" id="resetEmail" placeholder="exemplo@empresa.com" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    Enviar Link <i class="fas fa-paper-plane"></i>
                </button>
            </form>
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="font-size: 0.8rem; color: var(--text-tertiary);">
                    Lembrou a senha? <a href="#" id="toLoginFromReset" style="color: var(--text-primary); text-decoration: none; font-weight: 600;">Voltar ao Login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardView" class="dashboard-view">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header"><i class="fas fa-robot" style="font-size: 1.5rem;"></i><h2 style="font-size: 1.2rem; font-weight: 800;">TICO IA</h2></div>
            <nav class="sidebar-nav">
                <a class="nav-link active" data-view="main"><i class="fas fa-th-large"></i> Dashboard</a>
                <a class="nav-link" data-view="chat"><i class="fas fa-comments"></i> Centro de Mensagens</a>
                <a class="nav-link" data-view="agents"><i class="fas fa-users-cog"></i> Meus Agentes</a>
                <a class="nav-link" data-view="users"><i class="fas fa-user-shield"></i> Gestão de Usuários</a>
                <a class="nav-link" data-view="logs"><i class="fas fa-history"></i> Logs do Sistema</a>
                <a class="nav-link" data-view="chat-logs"><i class="fas fa-comments"></i> Auditoria de Chats</a>
                <a class="nav-link" data-view="settings"><i class="fas fa-cog"></i> Configurações</a>
            </nav>
            <div style="padding: 1.5rem; border-top: 1px solid var(--border-light);"><button class="btn btn-outline" id="logoutBtn" style="width: 100%;"><i class="fas fa-sign-out-alt"></i> Sair</button></div>
        </aside>

        <main class="main-content">
            <!-- Dashboard Content -->
            <div id="view-main">
                <header class="top-bar">
                    <div><h1>Olá, <span class="user-name-display">Usuário</span></h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Resumo da sua operação hoje.</p></div>
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <button class="btn btn-outline" id="exportCsvBtn" style="padding: 0.5rem 1rem; font-size: 0.75rem;"><i class="fas fa-file-export"></i> Exportar CSV</button>
                        <div class="glass" style="padding: 0.5rem 1rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <div style="text-align: right;"><p style="font-size: 0.8rem; font-weight: 600;" id="companyDisplay">Setor Demo</p><p style="font-size: 0.7rem; color: var(--text-tertiary);">Plano Enterprise</p></div>
                            <img src="https://ui-avatars.com/api/?name=User&background=random" class="user-avatar-display" style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--text-primary);">
                        </div>
                    </div>
                </header>

                <div class="stats-grid">
                    <div class="stat-card glass"><h3>Agentes Ativos</h3><div class="value">12</div></div>
                    <div class="stat-card glass"><h3>Requisições</h3><div class="value">8.4k</div></div>
                    <div class="stat-card glass"><h3>Resposta</h3><div class="value">1.2s</div></div>
                    <div class="stat-card glass"><h3>Economia</h3><div class="value">R$ 4.2k</div></div>
                </div>

                <div class="charts-grid">
                    <div class="chart-box glass">
                        <div class="chart-header"><h3>Volume de Interações</h3></div>
                        <canvas id="mainChart"></canvas>
                    </div>
                    <div class="chart-box glass">
                        <div class="chart-header"><h3>Distribuição por Setor</h3></div>
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>

                <div class="data-grid">
                    <div class="glass" style="padding: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                            <h3>Gestão de Agentes por Setor</h3>
                            <button class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.75rem;" onclick="TicoApp.openAgentModal()"><i class="fas fa-plus"></i> Novo Agente</button>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr><th>Agente</th><th>Setor</th><th>Status</th><th>Desempenho</th><th>Requisições</th><th>Última Atividade</th><th>Ações</th></tr>
                                </thead>
                                <tbody class="agents-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Centro de Mensagens View -->
            <div id="view-chat" class="chat-view">
                <header class="top-bar">
                    <div><h1>Centro de Mensagens</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Orquestração inteligente via Agente Supervisor.</p></div>
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="TicoApp.newChat()" style="padding: 0.5rem 1rem; font-size: 0.75rem;"><i class="fas fa-plus"></i> Nova Conversa</button>
                        <div class="agent-selector-wrapper">
                            <select class="input-field" id="agentSelector" onchange="TicoApp.selectChat(this.value)">
                                <option value="supervisor">Agente Supervisor (Roteamento)</option>
                                <option value="rh">Recrutador IA (RH)</option>
                                <option value="eng">Analista de Projetos (Engenharia)</option>
                                <option value="sup">Gestor de Estoque (Suprimentos)</option>
                                <option value="adm">Faturamento Auto (Administrativo)</option>
                            </select>
                        </div>
                    </div>
                </header>
                <div class="chat-layout">
                    <div class="chat-main glass">
                        <div class="chat-header-main">
                            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                <div id="activeAgentIcon" style="width: 40px; height: 40px; border-radius: 50%; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><i class="fas fa-shield-halved"></i></div>
                                <div><h3 id="activeAgentName">Agente Supervisor</h3><p id="activeAgentStatus" style="font-size: 0.7rem; color: var(--success);">Online • Roteamento Ativo</p></div>
                            </div>
                            <div class="supervisor-tag" id="activeAgentTag">SUPERVISOR</div>
                        </div>
                        <div class="chat-messages-main" id="mainChatMessages">
                            <div class="message bot"><span class="supervisor-tag">SUPERVISOR</span> Olá! Eu sou o Supervisor TICO IA. Descreva sua necessidade, anexe um arquivo ou envie um áudio para análise. <span class="message-info">Agora</span></div>
                        </div>
                        <form class="chat-input-area" id="mainChatForm">
                            <label for="chatFileInput" class="chat-action-btn"><i class="fas fa-paperclip"></i></label>
                            <input type="file" id="chatFileInput" style="display: none;" onchange="TicoApp.handleChatFileUpload(this)">
                            <button type="button" class="chat-action-btn" id="audioBtn" onclick="TicoApp.toggleAudioRecording()"><i class="fas fa-microphone"></i></button>
                            <input type="text" class="input-field" id="mainChatInput" placeholder="Digite sua mensagem..." style="margin-bottom: 0; flex: 1; min-width: 150px;">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Meus Agentes View -->
            <div id="view-agents" class="agents-view">
                <header class="top-bar">
                    <div><h1>Meus Agentes</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Gerencie todos os seus agentes inteligentes.</p></div>
                    <button class="btn btn-primary" onclick="TicoApp.openAgentModal()"><i class="fas fa-plus"></i> Criar Novo Agente</button>
                </header>
                <div class="glass" style="padding: 1.5rem;">
                    <div class="table-responsive">
                        <table>
                            <thead><tr><th>Agente</th><th>Setor</th><th>Status</th><th>Desempenho</th><th>Requisições</th><th>Última Atividade</th><th>Ações</th></tr></thead>
                            <tbody class="agents-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gestão de Usuários View -->
            <div id="view-users" class="users-view">
                <header class="top-bar">
                    <div><h1>Gestão de Usuários</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Controle acessos, departamentos e permissões.</p></div>
                    <button class="btn btn-primary" onclick="TicoApp.openUserModal()"><i class="fas fa-user-plus"></i> Novo Usuário</button>
                </header>
                <div class="glass" style="padding: 1.5rem;">
                    <div class="table-responsive">
                        <table>
                            <thead><tr><th>Usuário</th><th>Departamento</th><th>Nível de Acesso</th><th>Agentes Permitidos</th><th>Status</th><th>Ações</th></tr></thead>
                            <tbody id="usersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logs do Sistema View -->
            <div id="view-logs" class="logs-view">
                <header class="top-bar">
                    <div><h1>Logs do Sistema</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Histórico completo de auditoria e ações.</p></div>
                    <button class="btn btn-outline" onclick="TicoApp.clearLogs()"><i class="fas fa-trash"></i> Limpar Logs</button>
                </header>
                <div class="glass" style="padding: 1.5rem; max-height: 600px; overflow-y: auto;" id="systemLogsContainer"></div>
            </div>

            <!-- Auditoria de Chats View -->
            <div id="view-chat-logs" class="chat-logs-view">
                <header class="top-bar">
                    <div><h1>Auditoria de Chats</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Histórico de conversas entre usuários e agentes.</p></div>
                </header>
                <div class="glass" style="padding: 1.5rem; max-height: 600px; overflow-y: auto;" id="chatLogsContainer"></div>
            </div>

            <!-- Settings Content -->
            <div id="view-settings" class="settings-view">
                <header class="top-bar"><div><h1>Configurações</h1><p style="color: var(--text-secondary); font-size: 0.85rem;">Gerencie seu perfil e preferências.</p></div></header>
                <div class="settings-card glass" style="max-width: 600px; margin: 0 auto; padding: 2rem; width: 100%;">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
                        <div style="position: relative;">
                            <img src="https://ui-avatars.com/api/?name=User&background=random" id="settingsAvatar" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--text-primary);">
                            <label for="avatarInput" style="position: absolute; bottom: 0; right: 0; background: var(--text-primary); color: var(--bg-primary); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;"><i class="fas fa-camera"></i></label>
                            <input type="file" id="avatarInput" style="display: none;" accept="image/*">
                        </div>
                        <div style="text-align: center;"><h2 class="user-name-display">Usuário</h2><p style="color: var(--text-tertiary); font-size: 0.85rem;">Administrador do Sistema</p></div>
                    </div>
                    <form id="settingsForm">
                        <div class="input-group"><label>Nome de Exibição</label><input type="text" class="input-field" id="settingsName" required></div>
                        <div class="input-group"><label>E-mail (Não alterável)</label><input type="email" class="input-field" id="settingsEmail" disabled></div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar Alterações</button>
                    </form>
                </div>
            </div>

            <footer class="footer">
                <p>&copy; 2024 TICO IA. Todos os direitos reservados. Inteligência sob Governança.</p>
            </footer>
        </main>
    </div>

    <!-- User Modal -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content glass">
            <h2 id="modalTitle" style="margin-bottom: 1.5rem;">Novo Usuário</h2>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="input-group"><label>Nome Completo</label><input type="text" class="input-field" id="userName" required></div>
                <div class="input-group">
                    <label>Departamento</label>
                    <select class="input-field" id="userDept" required>
                        <option value="RH">RH</option><option value="TI">TI</option><option value="DP">DP</option><option value="ENGENHARIA">ENGENHARIA</option>
                        <option value="FINANCEIRO">FINANCEIRO</option><option value="SUPRIMENTOS">SUPRIMENTOS</option><option value="SMS">SMS</option><option value="ADMINISTRATIVO">ADMINISTRATIVO</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Nível de Acesso</label>
                    <select class="input-field" id="userRole" required>
                        <option value="Usuário">Usuário</option><option value="Manager">Manager</option><option value="Admin">Admin</option>
                    </select>
                </div>
                <div class="input-group"><label>Agentes Permitidos</label><input type="text" class="input-field" id="userAgents" placeholder="Ex: Recrutador, Faturamento"></div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button type="button" class="btn btn-outline" style="flex: 1; min-width: 120px;" onclick="TicoApp.closeUserModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1; min-width: 120px;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Agent Modal -->
    <div class="modal-overlay" id="agentModal">
        <div class="modal-content glass">
            <h2 style="margin-bottom: 1.5rem;">Configurar Novo Agente</h2>
            <form id="agentForm">
                <div class="input-group"><label>Nome do Agente</label><input type="text" class="input-field" id="agentName" placeholder="Ex: Analista Fiscal IA" required></div>
                <div class="input-group">
                    <label>Setor</label>
                    <select class="input-field" id="agentSector" required>
                        <option value="RH">RH</option><option value="TI">TI</option><option value="DP">DP</option><option value="ENGENHARIA">ENGENHARIA</option>
                        <option value="FINANCEIRO">FINANCEIRO</option><option value="SUPRIMENTOS">SUPRIMENTOS</option><option value="SMS">SMS</option><option value="ADMINISTRATIVO">ADMINISTRATIVO</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Modelo LLM</label>
                    <select class="input-field" id="agentLlm" required>
                        <option value="gpt-4">GPT-4 Turbo</option><option value="gpt-3.5">GPT-3.5</option><option value="claude-3">Claude 3 Opus</option><option value="gemini-pro">Gemini Pro</option>
                    </select>
                </div>
                <div class="input-group"><label>API Key do LLM</label><input type="password" class="input-field" id="agentApiKey" placeholder="sk-..." required></div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button type="button" class="btn btn-outline" style="flex: 1; min-width: 120px;" onclick="TicoApp.closeAgentModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1; min-width: 120px;">Criar Agente</button>
                </div>
            </form>
        </div>
    </div>

    <div id="notificationContainer"></div>

    <script>
        const TicoApp = {
            state: {
                user: null,
                tempUser: null,
                theme: localStorage.getItem('tico_theme') || 'dark',
                activeChat: 'supervisor',
                isRecording: false,
                agents: JSON.parse(localStorage.getItem('tico_agents')) || [
                    { id: 'rh', name: 'Recrutador IA', sector: 'RH', status: 'online', performance: 95, requests: '1.2k', lastSeen: '2 min', keywords: ['contratar', 'vaga', 'rh', 'recrutamento', 'talento', 'demissão', 'folha'], llm: 'GPT-4' },
                    { id: 'eng', name: 'Analista de Projetos', sector: 'ENGENHARIA', status: 'online', performance: 88, requests: '850', lastSeen: 'Agora', keywords: ['projeto', 'obra', 'engenharia', 'cálculo', 'planta', 'estrutura'], llm: 'GPT-4' },
                    { id: 'sup', name: 'Gestor de Estoque', sector: 'SUPRIMENTOS', status: 'online', performance: 92, requests: '2.4k', lastSeen: '5 min', keywords: ['estoque', 'compra', 'suprimentos', 'fornecedor', 'entrega', 'material'], llm: 'GPT-3.5' },
                    { id: 'adm', name: 'Faturamento Auto', sector: 'ADMINISTRATIVO', status: 'online', performance: 91, requests: '1.8k', lastSeen: '3 min', keywords: ['faturamento', 'nota', 'administrativo', 'boleto', 'pagamento', 'adm'], llm: 'Claude 3' }
                ],
                users: JSON.parse(localStorage.getItem('tico_users')) || [
                    { id: 1, name: 'Ana Silva', dept: 'RH', role: 'Manager', agents: 'Recrutador, Triagem', status: 'Ativo' },
                    { id: 2, name: 'Carlos Souza', dept: 'TI', role: 'Admin', agents: 'Todos', status: 'Ativo' }
                ],
                systemLogs: JSON.parse(localStorage.getItem('tico_system_logs')) || [],
                chatLogs: JSON.parse(localStorage.getItem('tico_chat_logs')) || [],
                chartData: { line: [400, 600, 800, 500, 900, 1200, 1000], pie: [35, 25, 25, 15] },
                validations: { cpf: false, password: false }
            },

            init() {
                try {
                    this.applyTheme();
                    const savedUser = localStorage.getItem('tico_user');
                    if (savedUser) this.state.user = JSON.parse(savedUser);
                    this.cacheDOM();
                    this.bindEvents();
                    this.checkAuth();
                    this.hideLoading();
                    this.handleResize();
                    window.addEventListener('resize', () => this.handleResize());
                } catch (e) { console.error(e); this.hideLoading(); }
            },

            handleResize() {
                const isMobile = window.innerWidth <= 1024;
                if (isMobile && this.dom.sidebar.classList.contains('open')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = 'auto';
                }
            },

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.state.theme);
                const icon = document.querySelector('#themeToggle i');
                if (icon) icon.className = this.state.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            },

            toggleTheme() {
                this.state.theme = this.state.theme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('tico_theme', this.state.theme);
                this.applyTheme();
                if (this.state.user) this.initCharts();
            },

            hideLoading() {
                const loading = document.getElementById('loadingScreen');
                if (loading) setTimeout(() => { loading.style.opacity = '0'; setTimeout(() => loading.style.display = 'none', 500); }, 800);
            },

            cacheDOM() {
                this.dom = {
                    authView: document.getElementById('authView'),
                    registerView: document.getElementById('registerView'),
                    verifyView: document.getElementById('verifyView'),
                    resetView: document.getElementById('resetView'),
                    dashboardView: document.getElementById('dashboardView'),
                    loginForm: document.getElementById('loginForm'),
                    registerForm: document.getElementById('registerForm'),
                    resetForm: document.getElementById('resetForm'),
                    logoutBtn: document.getElementById('logoutBtn'),
                    notificationContainer: document.getElementById('notificationContainer'),
                    themeToggle: document.getElementById('themeToggle'),
                    menuBtn: document.getElementById('menuBtn'),
                    sidebar: document.getElementById('sidebar'),
                    settingsForm: document.getElementById('settingsForm'),
                    avatarInput: document.getElementById('avatarInput'),
                    mainChatForm: document.getElementById('mainChatForm'),
                    mainChatInput: document.getElementById('mainChatInput'),
                    mainChatMessages: document.getElementById('mainChatMessages'),
                    activeAgentName: document.getElementById('activeAgentName'),
                    activeAgentStatus: document.getElementById('activeAgentStatus'),
                    activeAgentIcon: document.getElementById('activeAgentIcon'),
                    activeAgentTag: document.getElementById('activeAgentTag'),
                    agentSelector: document.getElementById('agentSelector'),
                    toRegister: document.getElementById('toRegister'),
                    toReset: document.getElementById('toReset'),
                    toLoginFromReg: document.getElementById('toLoginFromReg'),
                    toLoginFromReset: document.getElementById('toLoginFromReset'),
                    exportCsvBtn: document.getElementById('exportCsvBtn'),
                    regCpf: document.getElementById('regCpf'),
                    regSubmit: document.getElementById('regSubmit'),
                    usersTableBody: document.getElementById('usersTableBody'),
                    systemLogsContainer: document.getElementById('systemLogsContainer'),
                    chatLogsContainer: document.getElementById('chatLogsContainer'),
                    userModal: document.getElementById('userModal'),
                    userForm: document.getElementById('userForm'),
                    agentModal: document.getElementById('agentModal'),
                    agentForm: document.getElementById('agentForm'),
                    audioBtn: document.getElementById('audioBtn'),
                    verifyBtn: document.getElementById('verifyBtn'),
                    codeInputs: document.querySelectorAll('.code-input')
                };
            },

            bindEvents() {
                this.dom.themeToggle.addEventListener('click', () => this.toggleTheme());
                this.dom.menuBtn?.addEventListener('click', () => { 
                    this.dom.sidebar.classList.toggle('open'); 
                    this.dom.menuBtn.className = this.dom.sidebar.classList.contains('open') ? 'fas fa-times' : 'fas fa-bars';
                    this.handleResize();
                });
                
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        const view = e.currentTarget.getAttribute('data-view');
                        this.switchView(view);
                        if (window.innerWidth <= 1024) {
                            this.dom.sidebar.classList.remove('open');
                            this.dom.menuBtn.className = 'fas fa-bars';
                            this.handleResize();
                        }
                    });
                });

                this.dom.toRegister?.addEventListener('click', (e) => { e.preventDefault(); this.showRegister(); });
                this.dom.toReset?.addEventListener('click', (e) => { e.preventDefault(); this.showReset(); });
                this.dom.toLoginFromReg?.addEventListener('click', (e) => { e.preventDefault(); this.showAuth(); });
                this.dom.toLoginFromReset?.addEventListener('click', (e) => { e.preventDefault(); this.showAuth(); });

                this.dom.loginForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleLogin(); });
                this.dom.registerForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleRegister(); });
                this.dom.resetForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleReset(); });
                this.dom.logoutBtn?.addEventListener('click', () => this.handleLogout());
                this.dom.settingsForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleSaveSettings(); });
                this.dom.avatarInput?.addEventListener('change', (e) => this.handleAvatarUpload(e));
                this.dom.mainChatForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleMainChatMessage(); });
                this.dom.exportCsvBtn?.addEventListener('click', () => this.exportToCsv());
                this.dom.userForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleUserSubmit(); });
                this.dom.agentForm?.addEventListener('submit', (e) => { e.preventDefault(); this.handleAgentSubmit(); });
                this.dom.verifyBtn?.addEventListener('click', () => this.handleVerifyCode());

                this.dom.regCpf?.addEventListener('input', (e) => this.handleCpfInput(e));
                document.getElementById('regPassword')?.addEventListener('input', (e) => this.validatePassword(e.target.value));
                
                this.dom.codeInputs.forEach((input, idx) => {
                    input.addEventListener('input', (e) => {
                        if (e.target.value && idx < 5) this.dom.codeInputs[idx + 1].focus();
                    });
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Backspace' && !e.target.value && idx > 0) this.dom.codeInputs[idx - 1].focus();
                    });
                });

                document.querySelectorAll('.toggle-password').forEach(icon => {
                    icon.addEventListener('click', (e) => {
                        const input = document.getElementById(e.target.getAttribute('data-target'));
                        if (input) { input.type = input.type === 'password' ? 'text' : 'password'; e.target.classList.toggle('fa-eye'); e.target.classList.toggle('fa-eye-slash'); }
                    });
                });

                // Close sidebar when clicking outside on mobile
                document.addEventListener('click', (e) => {
                    if (window.innerWidth <= 1024 && 
                        !this.dom.sidebar.contains(e.target) && 
                        !this.dom.menuBtn.contains(e.target) &&
                        this.dom.sidebar.classList.contains('open')) {
                        this.dom.sidebar.classList.remove('open');
                        this.dom.menuBtn.className = 'fas fa-bars';
                        this.handleResize();
                    }
                });
            },

            handleCpfInput(e) {
                let value = e.target.value.replace(/\D/g, "");
                if (value.length > 11) value = value.slice(0, 11);
                value = value.replace(/(\d{3})(\d)/, "$1.$2").replace(/(\d{3})(\d)/, "$1.$2").replace(/(\d{3})(\d{1,2})$/, "$1-$2");
                e.target.value = value;
                const rawCpf = value.replace(/\D/g, "");
                if (rawCpf.length === 11) {
                    const isValid = this.validateCpf(rawCpf);
                    this.state.validations.cpf = isValid;
                    e.target.classList.toggle('invalid', !isValid);
                } else this.state.validations.cpf = false;
                this.updateRegSubmit();
            },

            validateCpf(cpf) {
                if (/^(\d)\1+$/.test(cpf)) return false;
                let sum = 0, rev;
                for (let i = 0; i < 9; i++) sum += parseInt(cpf.charAt(i)) * (10 - i);
                rev = 11 - (sum % 11);
                if (rev === 10 || rev === 11) rev = 0;
                if (rev !== parseInt(cpf.charAt(9))) return false;
                sum = 0;
                for (let i = 0; i < 10; i++) sum += parseInt(cpf.charAt(i)) * (11 - i);
                rev = 11 - (sum % 11);
                if (rev === 10 || rev === 11) rev = 0;
                if (rev !== parseInt(cpf.charAt(10))) return false;
                return true;
            },

            validatePassword(password) {
                const reqs = { uppercase: /[A-Z]/.test(password), lowercase: /[a-z]/.test(password), number: /[0-9]/.test(password), special: /[!@#$%^&*(),.?":{}|<>]/.test(password) };
                let allMet = true;
                Object.entries(reqs).forEach(([req, met]) => {
                    const el = document.querySelector(`.requirement[data-req="${req}"]`);
                    if (el) { el.classList.toggle('met', met); el.querySelector('i').className = met ? 'fas fa-check-circle' : 'fas fa-circle'; }
                    if (!met) allMet = false;
                });
                this.state.validations.password = allMet;
                this.updateRegSubmit();
            },

            updateRegSubmit() { 
                if (this.dom.regSubmit) {
                    this.dom.regSubmit.disabled = !(this.state.validations.cpf && this.state.validations.password); 
                }
            },

            switchView(view) {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-link[data-view="${view}"]`);
                if (activeLink) activeLink.classList.add('active');
                
                ['main', 'chat', 'agents', 'users', 'logs', 'chat-logs', 'settings'].forEach(v => {
                    const el = document.getElementById(`view-${v}`);
                    if (el) el.style.display = v === view ? 'block' : 'none';
                });
                
                if (view === 'main') this.initCharts();
                if (view === 'users') this.renderUsers();
                if (view === 'logs') this.renderSystemLogs();
                if (view === 'chat-logs') this.renderChatLogs();
                if (view === 'agents' || view === 'main') this.renderAgents();
            },

            selectChat(id) {
                this.state.activeChat = id;
                this.dom.agentSelector.value = id;
                const agent = id === 'supervisor' ? { name: 'Agente Supervisor', status: 'Online • Roteamento Ativo', icon: 'fa-shield-halved', tag: 'SUPERVISOR' } : { ...this.state.agents.find(a => a.id === id), tag: 'ESPECIALISTA' };
                this.dom.activeAgentName.textContent = agent.name;
                this.dom.activeAgentStatus.textContent = agent.status;
                this.dom.activeAgentIcon.innerHTML = `<i class="fas ${agent.icon || 'fa-robot'}"></i>`;
                this.dom.activeAgentTag.textContent = agent.tag;
                this.dom.mainChatMessages.innerHTML = `<div class="message bot">${id === 'supervisor' ? '<span class="supervisor-tag">SUPERVISOR</span>' : ''} Olá! Como posso ajudar você com questões de ${id === 'supervisor' ? 'toda a operação' : agent.sector}? <span class="message-info">Agora</span></div>`;
            },

            newChat() {
                this.selectChat(this.state.activeChat);
                this.notify('info', 'Nova Conversa', 'O histórico do chat foi reiniciado.');
                this.addLog('Nova Conversa', `Histórico de chat com ${this.state.activeChat} reiniciado.`);
            },

            toggleAudioRecording() {
                this.state.isRecording = !this.state.isRecording;
                this.dom.audioBtn.classList.toggle('recording', this.state.isRecording);
                if (this.state.isRecording) {
                    this.notify('info', 'Gravando Áudio', 'Fale agora...');
                } else {
                    this.addMainMessage('user', '<i class="fas fa-microphone"></i> Áudio enviado (0:05)');
                    this.addChatLog(this.state.activeChat, 'Áudio enviado');
                    setTimeout(() => this.addMainMessage('bot', 'Recebi seu áudio. Estou transcrevendo e analisando o conteúdo...'), 1000);
                }
            },

            handleMainChatMessage() {
                const text = this.dom.mainChatInput.value.trim();
                if (!text) return;
                this.addMainMessage('user', text);
                this.addChatLog(this.state.activeChat, text);
                this.dom.mainChatInput.value = '';
                if (this.state.activeChat === 'supervisor') {
                    setTimeout(() => {
                        const targetAgent = this.routeMessage(text);
                        if (targetAgent) {
                            this.addMainMessage('bot', `<span class="supervisor-tag">SUPERVISOR</span> Identifiquei que sua solicitação é sobre <strong>${targetAgent.sector}</strong>. Vou encaminhar você para o <strong>${targetAgent.name}</strong>.`);
                            setTimeout(() => this.selectChat(targetAgent.id), 2000);
                        } else this.addMainMessage('bot', `<span class="supervisor-tag">SUPERVISOR</span> Não consegui identificar um setor específico. Pode detalhar melhor se é sobre RH, Engenharia, Suprimentos ou Administrativo?`);
                    }, 1000);
                } else setTimeout(() => this.addMainMessage('bot', `Entendido. Como especialista de ${this.state.agents.find(a => a.id === this.state.activeChat).sector}, estou processando sua solicitação.`), 1000);
            },

            handleChatFileUpload(input) {
                const file = input.files[0];
                if (file) {
                    this.addMainMessage('user', `<i class="fas fa-file-alt"></i> Arquivo enviado: <strong>${file.name}</strong> (${(file.size / 1024).toFixed(1)} KB)`);
                    this.addChatLog(this.state.activeChat, `Arquivo: ${file.name}`);
                    this.notify('info', 'Arquivo Recebido', `O arquivo ${file.name} está sendo analisado pelo agente.`);
                    setTimeout(() => this.addMainMessage('bot', `Recebi o arquivo <strong>${file.name}</strong>. Iniciando análise de dados...`), 1500);
                    input.value = '';
                }
            },

            routeMessage(text) { const lowerText = text.toLowerCase(); return this.state.agents.find(agent => agent.keywords && agent.keywords.some(kw => lowerText.includes(kw))); },

            addMainMessage(sender, text) {
                const msg = document.createElement('div');
                msg.className = `message ${sender}`;
                msg.innerHTML = `${text} <span class="message-info">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
                this.dom.mainChatMessages.appendChild(msg);
                this.dom.mainChatMessages.scrollTop = this.dom.mainChatMessages.scrollHeight;
            },

            renderUsers() {
                this.dom.usersTableBody.innerHTML = this.state.users.map(u => `
                    <tr>
                        <td><div style="display: flex; align-items: center; gap: 0.75rem;"><img src="https://ui-avatars.com/api/?name=${u.name}&background=random" style="width: 30px; border-radius: 50%;"><span>${u.name}</span></div></td>
                        <td><span class="badge badge-sector">${u.dept}</span></td>
                        <td>${u.role}</td>
                        <td><span style="font-size: 0.75rem; color: var(--text-tertiary);">${u.agents}</span></td>
                        <td><span class="badge ${u.status === 'Ativo' ? 'badge-online' : 'badge-offline'}">${u.status}</span></td>
                        <td>
                            <i class="fas fa-edit" style="cursor: pointer; margin-right: 15px; color: var(--info);" onclick="TicoApp.openUserModal(${u.id})"></i>
                            <i class="fas fa-trash" style="cursor: pointer; color: var(--error);" onclick="TicoApp.deleteUser(${u.id})"></i>
                        </td>
                    </tr>
                `).join('');
            },

            openUserModal(id = null) {
                const modal = this.dom.userModal;
                const form = this.dom.userForm;
                const title = document.getElementById('modalTitle');
                form.reset();
                if (id) {
                    const user = this.state.users.find(u => u.id === id);
                    document.getElementById('userId').value = user.id;
                    document.getElementById('userName').value = user.name;
                    document.getElementById('userDept').value = user.dept;
                    document.getElementById('userRole').value = user.role;
                    document.getElementById('userAgents').value = user.agents;
                    title.textContent = 'Editar Usuário';
                } else {
                    document.getElementById('userId').value = '';
                    title.textContent = 'Novo Usuário';
                }
                modal.style.display = 'flex';
            },

            closeUserModal() { this.dom.userModal.style.display = 'none'; },

            handleUserSubmit() {
                const id = document.getElementById('userId').value;
                const userData = {
                    id: id ? parseInt(id) : Date.now(),
                    name: document.getElementById('userName').value,
                    dept: document.getElementById('userDept').value,
                    role: document.getElementById('userRole').value,
                    agents: document.getElementById('userAgents').value || 'Nenhum',
                    status: 'Ativo'
                };
                if (id) {
                    const index = this.state.users.findIndex(u => u.id === parseInt(id));
                    this.state.users[index] = userData;
                    this.addLog('Usuário Editado', `Dados de ${userData.name} atualizados.`);
                } else {
                    this.state.users.push(userData);
                    this.addLog('Novo Usuário', `${userData.name} adicionado ao sistema.`);
                }
                localStorage.setItem('tico_users', JSON.stringify(this.state.users));
                this.renderUsers();
                this.closeUserModal();
                this.notify('success', 'Sucesso!', id ? 'Usuário atualizado.' : 'Usuário criado.');
            },

            deleteUser(id) {
                if (confirm('Tem certeza que deseja excluir este usuário?')) {
                    const user = this.state.users.find(u => u.id === id);
                    this.state.users = this.state.users.filter(u => u.id !== id);
                    localStorage.setItem('tico_users', JSON.stringify(this.state.users));
                    this.renderUsers();
                    this.addLog('Usuário Excluído', `${user.name} removido do sistema.`);
                    this.notify('warning', 'Usuário Removido', 'O registro foi excluído com sucesso.');
                }
            },

            openAgentModal() { this.dom.agentModal.style.display = 'flex'; },
            closeAgentModal() { this.dom.agentModal.style.display = 'none'; },

            handleAgentSubmit() {
                const name = document.getElementById('agentName').value;
                const sector = document.getElementById('agentSector').value;
                const llm = document.getElementById('agentLlm').value;
                const apiKey = document.getElementById('agentApiKey').value;
                
                const newAgent = {
                    id: name.toLowerCase().replace(/\s+/g, '-'),
                    name, sector, llm, apiKey,
                    status: 'online', performance: 100, requests: '0', lastSeen: 'Agora',
                    keywords: [name.toLowerCase(), sector.toLowerCase()]
                };
                
                this.state.agents.push(newAgent);
                localStorage.setItem('tico_agents', JSON.stringify(this.state.agents));
                this.renderAgents();
                this.updateAgentSelector();
                this.closeAgentModal();
                this.addLog('Novo Agente Criado', `Agente ${name} configurado com ${llm}.`);
                this.notify('success', 'Agente Criado!', `O agente ${name} já está operacional.`);
            },

            updateAgentSelector() {
                const selector = this.dom.agentSelector;
                selector.innerHTML = '<option value="supervisor">Agente Supervisor (Roteamento)</option>' + 
                    this.state.agents.map(a => `<option value="${a.id}">${a.name} (${a.sector})</option>`).join('');
            },

            exportAgent(id) {
                const agent = this.state.agents.find(a => a.id === id);
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(agent, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `agente_${agent.id}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                this.notify('info', 'Agente Exportado', `Configurações de ${agent.name} baixadas.`);
            },

            renderSystemLogs() {
                this.dom.systemLogsContainer.innerHTML = this.state.systemLogs.map(l => `
                    <div class="log-item">
                        <span class="log-time">${l.time}</span>
                        <span class="log-action" style="color: var(--info);">${l.action}</span>
                        <span style="color: var(--text-secondary); flex: 1;">${l.details}</span>
                        <span style="color: var(--text-tertiary); font-size: 0.7rem;">Usuário: ${l.user}</span>
                    </div>
                `).join('');
            },

            renderChatLogs() {
                this.dom.chatLogsContainer.innerHTML = this.state.chatLogs.map(l => `
                    <div class="log-item">
                        <span class="log-time">${l.time}</span>
                        <span class="log-action" style="color: var(--success);">${l.user} &harr; ${l.agent}</span>
                        <span style="color: var(--text-secondary); flex: 1; font-style: italic;">"${l.message}"</span>
                    </div>
                `).join('');
            },

            addLog(action, details) {
                const log = { time: new Date().toLocaleString(), action, user: this.state.user?.name || 'Sistema', details };
                this.state.systemLogs.unshift(log);
                localStorage.setItem('tico_system_logs', JSON.stringify(this.state.systemLogs.slice(0, 100)));
            },

            addChatLog(agent, message) {
                const log = { time: new Date().toLocaleString(), user: this.state.user?.name || 'Usuário', agent, message };
                this.state.chatLogs.unshift(log);
                localStorage.setItem('tico_chat_logs', JSON.stringify(this.state.chatLogs.slice(0, 100)));
            },

            clearLogs() { this.state.systemLogs = []; localStorage.removeItem('tico_system_logs'); this.renderSystemLogs(); this.notify('info', 'Logs Limpos', 'O histórico de auditoria foi removido.'); },

            handleSaveSettings() {
                const newName = document.getElementById('settingsName').value;
                this.state.user.name = newName;
                localStorage.setItem('tico_user', JSON.stringify(this.state.user));
                this.updateUserDisplay();
                this.addLog('Alteração de Perfil', `Nome alterado para ${newName}`);
                this.notify('success', 'Sucesso!', 'Configurações salvas.');
            },

            handleAvatarUpload(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        this.state.user.avatar = event.target.result;
                        localStorage.setItem('tico_user', JSON.stringify(this.state.user));
                        this.updateUserDisplay();
                        this.addLog('Alteração de Perfil', 'Foto de perfil atualizada');
                        this.notify('success', 'Foto Atualizada!', 'Sua foto de perfil foi alterada.');
                    };
                    reader.readAsDataURL(file);
                }
            },

            updateUserDisplay() {
                const name = this.state.user.name;
                const avatar = this.state.user.avatar || `https://ui-avatars.com/api/?name=${name}&background=random`;
                document.querySelectorAll('.user-name-display').forEach(el => el.textContent = name);
                document.querySelectorAll('.user-avatar-display, #settingsAvatar').forEach(el => el.src = avatar);
                document.getElementById('companyDisplay').textContent = this.state.user.sector || 'Setor Demo';
                document.getElementById('settingsName').value = name;
                document.getElementById('settingsEmail').value = this.state.user.email;
            },

            checkAuth() { if (this.state.user) { this.showDashboard(); this.updateUserDisplay(); } else this.showAuth(); },

            handleLogin() {
                const email = document.getElementById('email').value;
                this.state.user = { email, name: email.split('@')[0], sector: 'TI' };
                localStorage.setItem('tico_user', JSON.stringify(this.state.user));
                this.addLog('Login Efetuado', `Usuário ${this.state.user.name} acessou o sistema`);
                this.showDashboard();
                this.updateUserDisplay();
            },

            handleRegister() {
                const name = document.getElementById('regName').value;
                const sector = document.getElementById('regSector').value;
                const email = document.getElementById('regEmail').value;
                this.state.tempUser = { email, name, sector };
                this.showVerify();
                this.notify('info', 'Código Enviado', 'Use o código 123456 para validar seu e-mail.');
            },

            handleVerifyCode() {
                let code = "";
                this.dom.codeInputs.forEach(input => code += input.value);
                if (code === "123456") {
                    this.state.user = this.state.tempUser;
                    localStorage.setItem('tico_user', JSON.stringify(this.state.user));
                    this.addLog('Novo Cadastro', `Usuário ${this.state.user.name} validado e cadastrado.`);
                    this.notify('success', 'E-mail Validado!', 'Seja bem-vindo ao TICO IA.');
                    this.showDashboard();
                    this.updateUserDisplay();
                } else {
                    this.notify('error', 'Código Inválido', 'O código inserido está incorreto.');
                    this.dom.codeInputs.forEach(input => { input.value = ""; input.style.borderColor = "var(--error)"; });
                    this.dom.codeInputs[0].focus();
                }
            },

            handleReset() {
                const email = document.getElementById('resetEmail').value;
                this.addLog('Recuperação de Senha', `Solicitação enviada para ${email}`);
                this.notify('info', 'E-mail Enviado!', `Link de recuperação enviado para ${email}`);
                setTimeout(() => this.showAuth(), 2000);
            },

            handleLogout() { this.addLog('Logout', 'Usuário saiu do sistema'); this.state.user = null; localStorage.removeItem('tico_user'); location.reload(); },

            showAuth() { document.getElementById('authView').style.display = 'flex'; document.getElementById('registerView').style.display = 'none'; document.getElementById('verifyView').style.display = 'none'; document.getElementById('resetView').style.display = 'none'; document.getElementById('dashboardView').style.display = 'none'; },
            showRegister() { document.getElementById('authView').style.display = 'none'; document.getElementById('registerView').style.display = 'flex'; document.getElementById('verifyView').style.display = 'none'; document.getElementById('resetView').style.display = 'none'; document.getElementById('dashboardView').style.display = 'none'; },
            showVerify() { document.getElementById('authView').style.display = 'none'; document.getElementById('registerView').style.display = 'none'; document.getElementById('verifyView').style.display = 'flex'; document.getElementById('resetView').style.display = 'none'; document.getElementById('dashboardView').style.display = 'none'; },
            showReset() { document.getElementById('authView').style.display = 'none'; document.getElementById('registerView').style.display = 'none'; document.getElementById('verifyView').style.display = 'none'; document.getElementById('resetView').style.display = 'flex'; document.getElementById('dashboardView').style.display = 'none'; },
            showDashboard() { document.getElementById('authView').style.display = 'none'; document.getElementById('registerView').style.display = 'none'; document.getElementById('verifyView').style.display = 'none'; document.getElementById('resetView').style.display = 'none'; document.getElementById('dashboardView').style.display = 'block'; this.initCharts(); this.renderAgents(); this.updateAgentSelector(); },

            renderAgents() {
                const html = this.state.agents.map(a => `
                    <tr>
                        <td><div style="display: flex; align-items: center; gap: 0.75rem;"><i class="fas fa-robot" style="color: var(--text-tertiary);"></i><span style="font-weight: 600;">${a.name}</span></div></td>
                        <td><span class="badge badge-sector">${a.sector}</span></td>
                        <td><span class="badge ${a.status === 'online' ? 'badge-online' : 'badge-offline'}">${a.status}</span></td>
                        <td><div style="display: flex; align-items: center; gap: 0.5rem;"><span style="font-weight: 700; font-size: 0.75rem;">${a.performance}%</span><div class="performance-bar"><div class="performance-fill" style="width: ${a.performance}%"></div></div></div></td>
                        <td style="font-weight: 500;">${a.requests}</td>
                        <td style="color: var(--text-tertiary); font-size: 0.75rem;">${a.lastSeen}</td>
                        <td>
                            <i class="fas fa-file-export" style="cursor: pointer; margin-right: 15px; color: var(--info);" title="Exportar Agente" onclick="TicoApp.exportAgent('${a.id}')"></i>
                            <i class="fas fa-trash" style="cursor: pointer; color: var(--error);" title="Excluir Agente" onclick="TicoApp.deleteAgent('${a.id}')"></i>
                        </td>
                    </tr>
                `).join('');
                document.querySelectorAll('.agents-table-body').forEach(el => el.innerHTML = html);
            },

            deleteAgent(id) {
                if (confirm('Deseja realmente excluir este agente?')) {
                    this.state.agents = this.state.agents.filter(a => a.id !== id);
                    localStorage.setItem('tico_agents', JSON.stringify(this.state.agents));
                    this.renderAgents();
                    this.updateAgentSelector();
                    this.notify('warning', 'Agente Removido', 'O agente foi excluído do sistema.');
                }
            },

            initCharts() {
                const isDark = this.state.theme === 'dark';
                const gridColor = isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)';
                const textColor = isDark ? '#737373' : '#404040';
                const ctxLine = document.getElementById('mainChart')?.getContext('2d');
                if (ctxLine) {
                    if (window.myLineChart) window.myLineChart.destroy();
                    window.myLineChart = new Chart(ctxLine, {
                        type: 'line',
                        data: { labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'], datasets: [{ label: 'Interações', data: this.state.chartData.line, borderColor: isDark ? '#fff' : '#000', backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)', fill: true, tension: 0.4 }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } } }
                    });
                }
                const ctxPie = document.getElementById('pieChart')?.getContext('2d');
                if (ctxPie) {
                    if (window.myPieChart) window.myPieChart.destroy();
                    window.myPieChart = new Chart(ctxPie, {
                        type: 'doughnut',
                        data: { labels: ['RH', 'Engenharia', 'Suprimentos', 'Adm'], datasets: [{ data: this.state.chartData.pie, backgroundColor: [isDark ? '#fff' : '#000', '#737373', '#404040', '#262626'], borderWidth: 0 }] },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: textColor, font: { size: 10 } } } }, cutout: '70%' }
                    });
                }
            },

            exportToCsv() {
                const rows = [["Tipo de Dado", "Categoria/Dia", "Valor"], ...this.state.chartData.line.map((val, i) => ["Interação Semanal", ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'][i], val]), ...this.state.chartData.pie.map((val, i) => ["Distribuição por Setor", ['RH', 'Engenharia', 'Suprimentos', 'Adm'][i], val + "%"])];
                let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "tico_ia_analytics.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                this.addLog('Exportação de Dados', 'Dados dos gráficos exportados para CSV');
                this.notify('success', 'Exportação Concluída!', 'O arquivo CSV foi gerado com sucesso.');
            },

            notify(type, title, message) {
                const id = Date.now();
                const html = `<div class="notification animate-fade" id="notif-${id}"><i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i><div><div style="font-weight: 700; font-size: 0.85rem;">${title}</div><div style="font-size: 0.75rem; color: var(--text-secondary);">${message}</div></div></div>`;
                document.getElementById('notificationContainer').insertAdjacentHTML('beforeend', html);
                setTimeout(() => document.getElementById(`notif-${id}`)?.remove(), 3000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => TicoApp.init());
    </script>
</body>
</html>